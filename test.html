<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <h1>1111</h1>
  <h1>2222</h1>
  <h1>3333</h1>
  <!-- 自定义html -->
  <span id="cusStaW" style="display: inline-block;overflow: hidden;">
    <script>
      var CUSSTA = CUSSTA || {};
      CUSSTA.el =  document.getElementById('cusStaW')
      CUSSTA.getCEl = function(obj,type){//type [0--获取所有, 1--获取下一级]
        let objCld = [] ;
        let objs = obj.getElementsByTagName('*');
        for(let i=0; i<objs.length; i++){
          let crI = objs[i]
          if(crI.nodeType != 1){//1为元素节点 2为属性节点
            continue ;
          }
          let temp = crI.parentNode;
          if(type === 0){
            if(crI.nodeType == 1){
              objCld[objCld.length] = crI ;
            }
          }else{
            if(temp.nodeType == 1){
                if(temp == obj){
                  objCld[objCld.length] = crI ;
                }
            }else if(temp.parentNode == obj){//父级为属性节点 他父级为传过来的obj的话
              objCld[objCld.length] = crI ;
            }
          }
        }
        return objCld;
      }
      CUSSTA.getCElTest = function(obj){
        return obj.getElementsByTagName('*');
      }
      CUSSTA.cFlt = function(v){
        return v.tagName!=='SCRIPT' && v.tagName!=='NOSCRIPT'
      }

      //body里边在此之前已经渲染的下级元素
      CUSSTA.bC = CUSSTA.getCEl(document.body,1)
      //wrapper中的所有元素
      CUSSTA.wEs = CUSSTA.getCEl(CUSSTA.el,0)

      // custom
      let a1 =  document.createElement('a')
      a1.innerHTML = "<img src='https://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=bsr&FlightID=29294475&Page=&PluID=0&Pos=1465774260'/>"
      a1.id = "a1"
      let a2 = document.createElement('h1')
      a2.innerHTML = '<div style="color:green;"><div>1111</div><span>2222</span></div>'
      document.body.append(a1)
      document.body.append(a2)
    </script>
    xxxxxx
    <h2>i an in wrapper</h2>
    <img style="width:100px;height:100px;display: inline-block;" src="https://file.ituring.com.cn/SmallCover/1911299bfad96c1e2ccf" id="a22" alt="">
    <iframe src="./iframe.html" frameborder="1"></iframe>
    <script src="https://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=rsb&c=28&pli=29294475&PluID=0&w=600&h=314&ord=[timestamp]"></script>
    <noscript>
      < a href=" " target="_blank">< img src="https://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=bsr&FlightID=29294475&Page=&PluID=0&Pos=1465774260" border=0 width=600 height=314></ a>
    </noscript>
  </span>
  <!-- 自定义js -->
  <script>
    let curTgt 
    let wEls = CUSSTA.getCEl(CUSSTA.el,0).filter(function (v) {
      return CUSSTA.wEs.indexOf(v) < 0 && v.tagName!=='SCRIPT' && v.tagName!=='NOSCRIPT';
    }).concat([CUSSTA.el])

    let bApdEls = CUSSTA.getCEl(document.body,1).filter(function (v) {
      return CUSSTA.bC.indexOf(v) < 0 && v.tagName!=='SCRIPT' && v.tagName!=='NOSCRIPT';
    })

    let aClkEls = bApdEls.map(function(v){
      return CUSSTA.getCEl(v,0) 
    }).reduce(function(a,b){
      return a.concat(b)
    },bApdEls).concat(wEls)

    window.onload = function(){
      document.onclick = function (e) {
        curTgt = e.target;
      }

      if(aClkEls.length){
        setInterval(function(){
          for (let i=0;i<aClkEls.length;i++) {
            let lpEle = aClkEls[i]
            if(lpEle.tagName ==='IFRAME'){
              if(document.activeElement === lpEle){
                console.log("clicked iframe");
                window.focus() 
              } 
            }else{
              if (curTgt === lpEle) {
                console.log("clicked ele"); 
                curTgt = null
              }
            }
          }
        },200)
      }
    }
  </script>
  <div>
    weeewe
    <h1>4444</h1>
  </div>
  <h1>5555</h1>
  <span>
    <script src="https://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=rsb&c=28&pli=29294475&PluID=0&w=600&h=314&ord=[timestamp]"></script>
    <noscript>
      < a href=" " target="_blank">< img src="https://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=bsr&FlightID=29294475&Page=&PluID=0&Pos=1465774260" border=0 width=600 height=314></ a>
    </noscript>
  </span>
</body>
</html>